import{r as m,j as e,a as h}from"./index-43388506.js";import{n as p,O as v,$ as N,S as L}from"./face-api.esm-bba85acd.js";const C=()=>{const[w,f]=m.useState(!0),[l,b]=m.useState([]);m.useEffect(()=>{(async()=>{console.log("Loading FaceAPI models");const a="./weights";await p.ssdMobilenetv1.load(a),await p.faceLandmark68Net.load(a),f(!1)})()},[]);const x=m.useCallback(async()=>{f(!0);let a=0;for(const c of l){console.log(a),a++;const d=new v({minConfidence:.45}),s=await N(c),g=(await L(s,d).withFaceLandmarks())[0];if(!g)continue;let i=document.createElement("canvas"),o=i.getContext("2d");if(!o)return;i.width=s.width,i.height=s.height,o.drawImage(s,0,0,s.width,s.height,0,0,s.width,s.height),o.beginPath();let n=new Path2D;[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,27,26,25,24,23,22,21,20,19,18].forEach((u,r)=>{const t=g.landmarks.positions[u-1];r==0?n==null||n.moveTo(t.x,t.y):n==null||n.lineTo(t.x,t.y)}),n.closePath(),o.clip(n,"evenodd"),o.clearRect(0,0,i.width,i.height),o.restore(),await new Promise(u=>{i.toBlob(function(r){if(r){const t=document.createElement("a");t.href=URL.createObjectURL(r),t.download=c.name,t.click(),t.remove()}i.width=i.height=0,u()},"image/png")})}f(!1)},[l]);return e("div",{className:"",children:e("div",{className:"border-base-300 bg-base-200 rounded-b-box rounded-tr-box flex min-h-screen min-w-[18rem] max-w-full flex-wrap items-center justify-center gap-2 overflow-x-hidden border bg-cover bg-top p-4 undefined",style:{backgroundSize:"5px 5px"},children:h("div",{className:"card w-1/2 min-h-[500px] bg-base-100 shadow-xl v-full",children:[e("h2",{className:"font-bold ml-3",children:"FaceClip"}),h("div",{className:"card-body",children:[h("h2",{className:"card-title flex justify-between",children:[e("input",{className:"file-input w-full max-w-xs",type:"file",multiple:!0,onChange:a=>{const c=a.target.files||[];for(const d of c)d.url=URL.createObjectURL(d);b([...l,...c])}}),e("div",{className:"flex items-center gap-3",children:e("button",{className:`btn btn-primary ${w&&"loading"}`,disabled:w,onClick:x,children:"Go"})})]}),e("div",{className:"divider"}),e("div",{className:"waterfall-container",children:l.map((a,c)=>h("div",{className:"indicator waterfall-card",children:[e("span",{className:"indicator-item badge cursor-pointer bg-red",onClick:()=>{l.splice(c,1),URL.revokeObjectURL(a.url),b([...l])},children:"X"}),e("div",{className:"card bg-base-100 shadow-xl overflow-hidden",children:e("figure",{children:e("img",{src:a.url,alt:"Shoes"})})})]}))})]})]})})})};export{C as default};
